<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="../favicon.svg">
    <title>Admin Guide - Windsurfer Tracker</title>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        h1 {
            color: #cc0000;
        }
        h2 {
            color: #333;
            border-bottom: 2px solid #cc0000;
            padding-bottom: 8px;
            margin-top: 40px;
        }
        h3 {
            color: #555;
            margin-top: 25px;
        }
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #0066cc;
            text-decoration: none;
        }
        .back-link:hover {
            text-decoration: underline;
        }
        .step {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .step-number {
            display: inline-block;
            background: #cc0000;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            margin-right: 10px;
        }
        .step h3 {
            display: inline;
            vertical-align: middle;
            margin-top: 0;
        }
        .step p, .step ul, .step ol {
            margin: 15px 0 0 40px;
        }
        code {
            background: #e8e8e8;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.95em;
        }
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.9em;
        }
        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        .info {
            background: #e8f4fd;
            border-left: 4px solid #0066cc;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        .danger {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .feature-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
        }
        .feature-item h4 {
            margin: 10px 0 5px 0;
            color: #cc0000;
        }
        .feature-item p {
            margin: 0;
            font-size: 0.9em;
            color: #666;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #f0f0f0;
            font-weight: 600;
        }
        .btn-example {
            display: inline-block;
            background: #cc0000;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 0.85em;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">&larr; Back to Installation</a>

    <h1>Admin Guide</h1>
    <p>This guide covers administration features for race organisers, including event management, course setup, user management, and preparing for race day.</p>

    <div class="info">
        <strong>Two Types of Access:</strong>
        <ul style="margin: 10px 0 0 20px;">
            <li><strong>Manager password:</strong> Create and configure events at <a href="https://wstracker.org/manage.html">wstracker.org/manage.html</a></li>
            <li><strong>Admin password:</strong> Per-event admin access for course setup, user editing, and track clearing</li>
        </ul>
    </div>

    <h2>Quick Reference</h2>

    <div class="feature-list">
        <div class="feature-item">
            <h4>Create Events</h4>
            <p>Set up new races/regattas</p>
        </div>
        <div class="feature-item">
            <h4>Set Course</h4>
            <p>Define start, marks, and finish</p>
        </div>
        <div class="feature-item">
            <h4>Edit Users</h4>
            <p>Change display names and roles</p>
        </div>
        <div class="feature-item">
            <h4>Clear Tracks</h4>
            <p>Reset before each race</p>
        </div>
        <div class="feature-item">
            <h4>Race Sub-logs</h4>
            <p>Mark races in track review</p>
        </div>
        <div class="feature-item">
            <h4>Export Tracks</h4>
            <p>GPX, CSV, GeoJSON, FIT</p>
        </div>
    </div>

    <h2>Creating and Managing Events</h2>

    <p>Each race or regatta is an "event" with its own tracking data, passwords, and course. Events are managed at the Event Management page.</p>

    <div class="step">
        <span class="step-number">1</span>
        <h3>Open Event Management</h3>
        <p>Go to <a href="https://wstracker.org/manage.html">https://wstracker.org/manage.html</a> in your web browser.</p>
    </div>

    <div class="step">
        <span class="step-number">2</span>
        <h3>Enter Manager Password</h3>
        <p>Enter the manager password to access event management. This password is provided by the server administrator.</p>
    </div>

    <div class="step">
        <span class="step-number">3</span>
        <h3>Create a New Event</h3>
        <p>Click <strong>"Create Event"</strong> and fill in:</p>
        <ul>
            <li><strong>Event Name:</strong> The name of your race or regatta (e.g., "NZ Interdominion 2026")</li>
            <li><strong>Description:</strong> Optional details about the event</li>
            <li><strong>Admin Password:</strong> Password for course setup, user editing, and track clearing</li>
            <li><strong>Tracker Password:</strong> Password that participants enter in their tracking apps</li>
        </ul>
    </div>

    <div class="info">
        <strong>Password Tips:</strong>
        <ul style="margin: 10px 0 0 20px;">
            <li>The <strong>tracker password</strong> should be easy to share with participants</li>
            <li>The <strong>admin password</strong> should be kept private for race organisers only</li>
            <li>Each event has its own passwords - they don't affect other events</li>
        </ul>
    </div>

    <h3>Managing Existing Events</h3>

    <p>From the Event Management page you can:</p>
    <ul>
        <li><strong>Edit:</strong> Change event name, description, or passwords</li>
        <li><strong>Archive:</strong> Hide completed events from the public list (data is preserved)</li>
        <li><strong>View:</strong> Open the live tracking map for the event</li>
    </ul>

    <h2>Entering Admin Mode (Per-Event)</h2>

    <p>Each event has its own admin mode for course setup, user editing, and track management.</p>

    <div class="step">
        <span class="step-number">1</span>
        <h3>Open the Tracking Map</h3>
        <p>Go to <a href="https://wstracker.org">https://wstracker.org</a> and select your event from the list.</p>
    </div>

    <div class="step">
        <span class="step-number">2</span>
        <h3>Click Admin Button</h3>
        <p>Click the <span class="btn-example">Admin</span> button in the top-right corner of the map.</p>
    </div>

    <div class="step">
        <span class="step-number">3</span>
        <h3>Enter Event Admin Password</h3>
        <p>Enter the admin password for this event (set when the event was created). Once authenticated, you'll see additional admin controls appear.</p>
    </div>

    <h2>Setting Up the Course</h2>

    <p>The course defines the start line, race marks, and finish line that are displayed on the map.</p>

    <div class="step">
        <span class="step-number">1</span>
        <h3>Enter Edit Course Mode</h3>
        <p>In admin mode, click the <strong>"Edit Course"</strong> button. The map will enter course editing mode.</p>
    </div>

    <div class="step">
        <span class="step-number">2</span>
        <h3>Set the Start Position</h3>
        <p>Click on the map where the start line should be. A green marker will appear.</p>
    </div>

    <div class="step">
        <span class="step-number">3</span>
        <h3>Add Course Marks</h3>
        <p>Click on the map to add each mark in order. Yellow markers will appear for each mark. Add as many marks as needed for your course.</p>
    </div>

    <div class="step">
        <span class="step-number">4</span>
        <h3>Save the Course</h3>
        <p>When you've added all marks, long-press on the map to finish (or double-click on desktop). The last point becomes the finish with a checkered flag.</p>
    </div>

    <div class="info">
        <strong>Tip:</strong> You can edit the course at any time. Changes take effect immediately for all viewers.
    </div>

    <h2>Editing User Names and Roles</h2>

    <p>You can change how participants appear on the map by editing their display name and role.</p>

    <h3>Why Edit Users?</h3>
    <ul>
        <li><strong>Display names:</strong> Change "S42" to "John Smith" for easier identification</li>
        <li><strong>Sail Colours:</strong>Add the sail color for easy identification on the water</li>
        <li><strong>Roles:</strong> Correct a user who registered with the wrong role (sailor, support, spectator)</li>
        <li><strong>Auto-generated IDs:</strong> Users may appear with auto-generated IDs that you may want to rename</li>
    </ul>

    <div class="step">
        <span class="step-number">1</span>
        <h3>Find the User</h3>
        <p>Click on a user's marker on the map, or find them in the sailor list on the left side of the screen.</p>
    </div>

    <div class="step">
        <span class="step-number">2</span>
        <h3>Click Edit</h3>
        <p>In admin mode, you'll see an <strong>"Edit"</strong> button in the user's popup or list entry. Click it.</p>
    </div>

    <div class="step">
        <span class="step-number">3</span>
        <h3>Change Name or Role</h3>
        <p>In the edit dialog:</p>
        <ul>
            <li><strong>Display Name:</strong> Enter a friendly name (e.g., "John Smith")</li>
            <li><strong>Role:</strong> Select Sailor, Support, or Spectator</li>
        </ul>
        <p>Leave the name blank to use the original ID.</p>
    </div>

    <div class="step">
        <span class="step-number">4</span>
        <h3>Save Changes</h3>
        <p>Click <strong>"Save"</strong>. The changes appear immediately on the map for all viewers.</p>
    </div>

    <table>
        <tr>
            <th>Role</th>
            <th>Icon</th>
            <th>Description</th>
        </tr>
        <tr>
            <td>Sailor</td>
            <td>Windsurfer</td>
            <td>Race participants</td>
        </tr>
        <tr>
            <td>Support</td>
            <td>Powerboat</td>
            <td>Safety boats, chase boats</td>
        </tr>
        <tr>
            <td>Spectator</td>
            <td>Binoculars</td>
            <td>Observers, media</td>
        </tr>
    </table>

    <h2>Clearing Track Logs</h2>

    <p>Before each race, you should clear the track logs to start fresh. This removes the historical track lines from the live map and starts a new log file.</p>

    <div class="info">
        <strong>Data is preserved:</strong> Clearing tracks does not delete any data. It simply starts a new log file. All previous tracks remain available in the <strong>Track Review</strong> tool.
    </div>

    <div class="step">
        <span class="step-number">1</span>
        <h3>Enter Admin Mode</h3>
        <p>Click Admin and enter the password if not already in admin mode.</p>
    </div>

    <div class="step">
        <span class="step-number">2</span>
        <h3>Click Clear Tracks</h3>
        <p>Click the <strong>"Clear Tracks"</strong> button in the admin panel.</p>
    </div>

    <div class="step">
        <span class="step-number">3</span>
        <h3>Confirm</h3>
        <p>Confirm the action when prompted. Track history will be cleared from the live map and a new log started.</p>
    </div>

    <div class="info">
        <strong>What Changes:</strong>
        <ul style="margin-bottom: 0;">
            <li>Track lines (position history) cleared from live map</li>
            <li>A new log file is started on the server</li>
        </ul>
        <strong>What Remains:</strong>
        <ul style="margin-bottom: 0;">
            <li>Current live positions</li>
            <li>User name/role overrides</li>
            <li>Course definition</li>
            <li>Previous log files (viewable in Track Review)</li>
        </ul>
    </div>

    <h2>Race Day Checklist</h2>

    <div class="step">
        <h3>Before the Race</h3>
        <ol style="margin-left: 20px;">
            <li>Verify the course is set correctly</li>
            <li>Clear track logs from any previous testing or races</li>
            <li>Check that all participants appear on the map</li>
            <li>Edit any user names that need clarification</li>
            <li>Confirm support boats are showing with correct role</li>
        </ol>
    </div>

    <div class="step">
        <h3>During the Race</h3>
        <ol style="margin-left: 20px;">
            <li>Monitor the map for participant positions</li>
            <li>Watch for <strong>ASSIST</strong> alerts (flashing red markers)</li>
            <li>Check that all expected participants are transmitting</li>
        </ol>
    </div>

    <div class="step">
        <h3>After the Race</h3>
        <ol style="margin-left: 20px;">
            <li>Track logs are automatically saved on the server</li>
            <li>Use Track Review to analyze the race</li>
            <li>Clear tracks before the next race if running multiple races</li>
        </ol>
    </div>

    <h2>Track Review</h2>

    <p>After a race, use the Track Review page to analyze tracks in detail. Access it at <a href="https://wstracker.org/review.html">https://wstracker.org/review.html</a> and select your event.</p>

    <h3>Basic Features</h3>
    <ul>
        <li><strong>Date selection:</strong> Review tracks from any day</li>
        <li><strong>Time range slider:</strong> Focus on specific portions of the race</li>
        <li><strong>Speed coloring:</strong> Tracks colored from green (slow) to red (fast)</li>
        <li><strong>Outlier filtering:</strong> Remove GPS glitches automatically</li>
        <li><strong>Playback:</strong> Animate tracks with play/pause and draggable position indicator</li>
        <li><strong>30-second tail mode:</strong> Show only recent track history during playback</li>
    </ul>

    <h3>Race Sub-logs (Admin Feature)</h3>
    <p>Admins can create named race markers to quickly jump to specific races within a day's log.</p>

    <div class="step">
        <span class="step-number">1</span>
        <h3>Enable Admin Mode</h3>
        <p>In Track Review, open the <strong>Options</strong> menu and check <strong>"Admin Mode"</strong>. Enter the event admin password when prompted.</p>
    </div>

    <div class="step">
        <span class="step-number">2</span>
        <h3>Select Time Range</h3>
        <p>Use the time sliders to select the portion of the log that corresponds to a race.</p>
    </div>

    <div class="step">
        <span class="step-number">3</span>
        <h3>Create Race Marker</h3>
        <p>Click the green <strong>"+"</strong> button next to the log name. Enter a name for the race (e.g., "Race 1", "Race 2").</p>
    </div>

    <div class="info">
        <strong>Using Race Markers:</strong>
        <ul style="margin: 10px 0 0 20px;">
            <li>Race markers appear indented below their parent log</li>
            <li>Click a race to jump to that time range with full slider resolution</li>
            <li>Double-click a graph or use Reset to return to full race range</li>
            <li>Share links that include the race selection</li>
            <li>Admins see a red <strong>"âˆ’"</strong> button to delete race markers</li>
        </ul>
    </div>

    <h3>Available Graphs</h3>
    <p>Enable graphs from the "Graphs" dropdown to visualize:</p>
    <ul>
        <li><strong>Speed:</strong> Speed over time in knots</li>
        <li><strong>Distance:</strong> Cumulative distance traveled</li>
        <li><strong>Battery:</strong> Battery level over time</li>
        <li><strong>Signal:</strong> Mobile signal strength (0-4 bars)</li>
        <li><strong>Latency:</strong> Network delay from phone to server</li>
        <li><strong>Heart Rate:</strong> Heart rate from connected devices (Apple Watch)</li>
        <li><strong>Accuracy:</strong> GPS accuracy in meters</li>
    </ul>

    <div class="info">
        <strong>Graph Interactions:</strong>
        <ul style="margin: 10px 0 0 20px;">
            <li>Click on any graph to highlight the corresponding position on the map</li>
            <li>Drag to select a time range (rubber-band selection)</li>
            <li>Double-click to reset to full time range</li>
            <li>Drag the bottom edge of a graph to resize it</li>
        </ul>
    </div>

    <h3>Export Tracks</h3>
    <p>Export track data for selected users using the <strong>Export</strong> button:</p>
    <ul>
        <li><strong>GPX:</strong> Standard GPS format for most mapping apps</li>
        <li><strong>CSV:</strong> Spreadsheet format with all data fields</li>
        <li><strong>GeoJSON:</strong> Web mapping format</li>
        <li><strong>FIT:</strong> Garmin format, compatible with Waterspeed app for GPS speed analysis</li>
    </ul>

    <h3>Sharing Links</h3>
    <p>Click the <strong>Copy Link</strong> button to share a URL that includes:</p>
    <ul>
        <li>Selected date and log</li>
        <li>Selected race (if any)</li>
        <li>Selected users</li>
        <li>Time range selection</li>
        <li>Map position and zoom</li>
        <li>Enabled graphs</li>
    </ul>

    <h2>Troubleshooting</h2>

    <h3>User not appearing on map</h3>
    <ul>
        <li>Check they have mobile signal/data connection</li>
        <li>Verify their app is configured with correct server and password</li>
        <li>Ask them to check their ACK rate (should be > 0%)</li>
        <li>For iPhone users, ensure the app has "Always" location permission</li>
    </ul>

    <h3>Track lines not showing</h3>
    <ul>
        <li>Enable "Show Tracks" in the map controls</li>
        <li>Tracks only appear after multiple position updates</li>
        <li>Check if tracks were recently cleared</li>
    </ul>

    <h3>Course not visible</h3>
    <ul>
        <li>Ensure you clicked "Save Course" after editing</li>
        <li>Refresh the browser page</li>
        <li>Check that course points are within the visible map area</li>
    </ul>

    <p style="margin-top: 40px; text-align: center;">
        <a href="index.html" class="back-link">&larr; Back to Installation</a>
    </p>
</body>
</html>
